---
permalink: maintain/restoring-object-data-to-storage-volume-for-appliance.html 
sidebar: sidebar 
keywords: restore replicated data, restore erasure-coded data, recover appliance storage node, recover storage volume 
summary: 'Après avoir récupéré les volumes de stockage pour le nœud de stockage de l"appliance, vous pouvez restaurer les données d"objet répliquées ou codées par effacement qui ont été perdues lors de l"échec du nœud de stockage.' 
---
= Restaurer les données d'objet sur le volume de stockage de l'appareil
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Après avoir récupéré les volumes de stockage pour le nœud de stockage de l'appliance, vous pouvez restaurer les données d'objet répliquées ou codées par effacement qui ont été perdues lors de l'échec du nœud de stockage.



== Quelle procédure dois-je utiliser ?

Dans la mesure du possible, restaurez les données de l'objet à l'aide de la page *Restauration de volume* dans le gestionnaire de grille.

* Si les volumes sont répertoriés dans *MAINTENANCE* > *Restauration de volume* > *Nœuds à restaurer*, restaurez les données de l'objet à l'aide de l'link:../maintain/restoring-volume.html["Page de restauration de volume dans le gestionnaire de grille"] .
* Si les volumes ne sont pas répertoriés dans *MAINTENANCE* > *Restauration de volume* > *Nœuds à restaurer*, suivez les étapes ci-dessous pour utiliser le `repair-data` script pour restaurer les données de l'objet.
+
Si le nœud de stockage récupéré contient moins de volumes que le nœud qu'il remplace, vous devez utiliser le `repair-data` scénario.




NOTE: Le script de réparation des données est obsolète et sera supprimé dans une prochaine version.  Lorsque cela est possible, utilisez lelink:../maintain/restoring-volume.html["Procédure de restauration de volume dans le gestionnaire de grille"] .



== Utilisez le `repair-data` script pour restaurer les données de l'objet

.Avant de commencer
* Vous avez confirmé que le nœud de stockage récupéré a un état de connexion *Connecté*image:../media/icon_alert_green_checkmark.png["icône d'alerte coche verte"] dans l'onglet *NODES* > *Aperçu* dans le Gestionnaire de grille.


.À propos de cette tâche
Les données d'objet peuvent être restaurées à partir d'autres nœuds de stockage ou d'un pool de stockage cloud, en supposant que les règles ILM de la grille ont été configurées de manière à ce que des copies d'objet soient disponibles.

Notez ce qui suit :

* Si une règle ILM a été configurée pour stocker une seule copie répliquée et que cette copie existait sur un volume de stockage défaillant, vous ne pourrez pas récupérer l'objet.
* Si la seule copie restante d'un objet se trouve dans un pool de stockage Cloud, StorageGRID doit émettre plusieurs requêtes au point de terminaison du pool de stockage Cloud pour restaurer les données de l'objet.  Avant d’effectuer cette procédure, contactez le support technique pour obtenir de l’aide afin d’estimer le délai de récupération et les coûts associés.




== À propos de la `repair-data` scénario

Pour restaurer les données d'un objet, exécutez la commande `repair-data` scénario.  Ce script démarre le processus de restauration des données d'objet et fonctionne avec l'analyse ILM pour garantir que les règles ILM sont respectées.

Sélectionnez *Données répliquées* ou *Données codées par effacement (EC)* ci-dessous pour découvrir les différentes options pour `repair-data` script, selon que vous restaurez des données répliquées ou des données codées par effacement.  Si vous devez restaurer les deux types de données, vous devez exécuter les deux ensembles de commandes.


NOTE: Pour plus d'informations sur le `repair-data` script, entrez `repair-data --help` à partir de la ligne de commande du nœud d'administration principal.


NOTE: Le script de réparation des données est obsolète et sera supprimé dans une prochaine version.  Lorsque cela est possible, utilisez lelink:../maintain/restoring-volume.html["Procédure de restauration de volume dans le gestionnaire de grille"] .

[role="tabbed-block"]
====
.Données répliquées
--
Deux commandes sont disponibles pour restaurer les données répliquées, selon que vous devez réparer l'intégralité du nœud ou uniquement certains volumes du nœud :

`repair-data start-replicated-node-repair`

`repair-data start-replicated-volume-repair`

Vous pouvez suivre les réparations des données répliquées avec cette commande :

`repair-data show-replicated-repair-status`

--
.Données codées par effacement (EC)
--
Deux commandes sont disponibles pour restaurer les données codées par effacement, selon que vous devez réparer l'intégralité du nœud ou uniquement certains volumes du nœud :

`repair-data start-ec-node-repair`

`repair-data start-ec-volume-repair`

Vous pouvez suivre les réparations des données codées par effacement avec cette commande :

`repair-data show-ec-repair-status`


NOTE: Les réparations des données codées par effacement peuvent commencer lorsque certains nœuds de stockage sont hors ligne.  Cependant, si toutes les données codées par effacement ne peuvent pas être comptabilisées, la réparation ne peut pas être effectuée.  La réparation sera terminée une fois que tous les nœuds seront disponibles.


NOTE: Le travail de réparation EC réserve temporairement une grande quantité de stockage.  Des alertes de stockage peuvent être déclenchées, mais seront résolues une fois la réparation terminée.  S'il n'y a pas suffisamment de stockage pour la réservation, la tâche de réparation EC échouera.  Les réservations de stockage sont libérées lorsque la tâche de réparation EC est terminée, que la tâche ait échoué ou réussi.

--
====


== Rechercher le nom d'hôte pour le nœud de stockage

. Connectez-vous au nœud d’administration principal :
+
.. Entrez la commande suivante : `ssh admin@_primary_Admin_Node_IP_`
.. Entrez le mot de passe indiqué dans le `Passwords.txt` déposer.
.. Entrez la commande suivante pour passer en root : `su -`
.. Entrez le mot de passe indiqué dans le `Passwords.txt` déposer.
+
Lorsque vous êtes connecté en tant que root, l'invite passe de `$` à `#` .



. Utilisez le `/etc/hosts` fichier pour trouver le nom d'hôte du nœud de stockage pour les volumes de stockage restaurés.  Pour voir une liste de tous les nœuds de la grille, saisissez ce qui suit : `cat /etc/hosts` .




== Réparer les données si tous les volumes sont en panne

Si tous les volumes de stockage sont en panne, réparez l’ensemble du nœud.  Suivez les instructions pour les *données répliquées*, les *données codées par effacement (EC)* ou les deux, selon que vous utilisez des données répliquées, des données codées par effacement (EC) ou les deux.

Si seuls certains volumes sont en panne, accédez à<<Réparer les données si seuls certains volumes sont défaillants>> .


NOTE: Tu ne peux pas courir `repair-data` opérations pour plusieurs nœuds en même temps.  Pour récupérer plusieurs nœuds, contactez le support technique.

[role="tabbed-block"]
====
.Données répliquées
--
Si votre grille comprend des données répliquées, utilisez le `repair-data start-replicated-node-repair` commande avec le `--nodes` option, où `--nodes` est le nom d'hôte (nom du système), pour réparer l'ensemble du nœud de stockage.

Cette commande répare les données répliquées sur un nœud de stockage nommé SG-DC-SN3 :

`repair-data start-replicated-node-repair --nodes SG-DC-SN3`


NOTE: Lorsque les données d'objet sont restaurées, l'alerte *Objets perdus* est déclenchée si le système StorageGRID ne parvient pas à localiser les données d'objet répliquées. Des alertes peuvent être déclenchées sur les nœuds de stockage dans tout le système. Vous devez déterminer la cause de la perte et si une récupération est possible. Voir link:../troubleshoot/investigating-lost-objects.html["Enquêter sur les objets perdus"] .

--
.Données codées par effacement (EC)
--
Si votre grille contient des données codées par effacement, utilisez le `repair-data start-ec-node-repair` commande avec le `--nodes` option, où `--nodes` est le nom d'hôte (nom du système), pour réparer l'ensemble du nœud de stockage.

Cette commande répare les données codées par effacement sur un nœud de stockage nommé SG-DC-SN3 :

`repair-data start-ec-node-repair --nodes SG-DC-SN3`

L'opération renvoie un unique `repair ID` qui identifie ceci `repair_data` opération.  Utilisez ceci `repair ID` pour suivre les progrès et les résultats de la `repair_data` opération.  Aucun autre commentaire n’est renvoyé une fois le processus de récupération terminé.

Les réparations des données codées par effacement peuvent commencer lorsque certains nœuds de stockage sont hors ligne.  La réparation sera terminée une fois que tous les nœuds seront disponibles.

--
====


== Réparer les données si seuls certains volumes sont défaillants

Si seulement certains volumes sont défaillants, réparez les volumes concernés.  Suivez les instructions pour les *données répliquées*, les *données codées par effacement (EC)* ou les deux, selon que vous utilisez des données répliquées, des données codées par effacement (EC) ou les deux.

Si tous les volumes sont en panne, accédez à<<Réparer les données si tous les volumes sont en panne>> .

Saisissez les ID de volume en hexadécimal.  Par exemple, `0000` est le premier volume et `000F` est le seizième volume.  Vous pouvez spécifier un volume, une plage de volumes ou plusieurs volumes qui ne sont pas dans une séquence.

Tous les volumes doivent être sur le même nœud de stockage.  Si vous devez restaurer des volumes pour plusieurs nœuds de stockage, contactez le support technique.

[role="tabbed-block"]
====
.Données répliquées
--
Si votre grille contient des données répliquées, utilisez le `start-replicated-volume-repair` commande avec le `--nodes` option pour identifier le nœud (où `--nodes` est le nom d'hôte du nœud).  Ajoutez ensuite soit le `--volumes` ou `--volume-range` option, comme illustré dans les exemples suivants.

*Volume unique* : Cette commande restaure les données répliquées sur le volume `0002` sur un nœud de stockage nommé SG-DC-SN3 :

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volumes 0002`

*Plage de volumes* : Cette commande restaure les données répliquées sur tous les volumes de la plage `0003` à `0009` sur un nœud de stockage nommé SG-DC-SN3 :

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volume-range 0003,0009`

*Plusieurs volumes non séquentiels* : Cette commande restaure les données répliquées sur les volumes `0001` , `0005` , et `0008` sur un nœud de stockage nommé SG-DC-SN3 :

`repair-data start-replicated-volume-repair --nodes SG-DC-SN3 --volumes 0001,0005,0008`


NOTE: Lorsque les données d'objet sont restaurées, l'alerte *Objets perdus* est déclenchée si le système StorageGRID ne parvient pas à localiser les données d'objet répliquées. Des alertes peuvent être déclenchées sur les nœuds de stockage dans tout le système. Notez la description de l’alerte et les actions recommandées pour déterminer la cause de la perte et si la récupération est possible.

--
.Données codées par effacement (EC)
--
Si votre grille contient des données codées par effacement, utilisez le `start-ec-volume-repair` commande avec le `--nodes` option pour identifier le nœud (où `--nodes` est le nom d'hôte du nœud).  Ajoutez ensuite soit le `--volumes` ou `--volume-range` option, comme illustré dans les exemples suivants.

*Volume unique* : Cette commande restaure les données codées par effacement sur le volume `0007` sur un nœud de stockage nommé SG-DC-SN3 :

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volumes 0007`

*Plage de volumes* : Cette commande restaure les données codées par effacement sur tous les volumes de la plage `0004` à `0006` sur un nœud de stockage nommé SG-DC-SN3 :

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volume-range 0004,0006`

*Plusieurs volumes non séquentiels* : cette commande restaure les données codées par effacement sur les volumes `000A` , `000C` , et `000E` sur un nœud de stockage nommé SG-DC-SN3 :

`repair-data start-ec-volume-repair --nodes SG-DC-SN3 --volumes 000A,000C,000E`

Le `repair-data` l'opération renvoie un unique `repair ID` qui identifie ceci `repair_data` opération.  Utilisez ceci `repair ID` pour suivre les progrès et les résultats de la `repair_data` opération.  Aucun autre commentaire n’est renvoyé une fois le processus de récupération terminé.


NOTE: Les réparations des données codées par effacement peuvent commencer lorsque certains nœuds de stockage sont hors ligne.  La réparation sera terminée une fois que tous les nœuds seront disponibles.

--
====


== Réparations de moniteurs

Surveillez l'état des tâches de réparation, selon que vous utilisez des *données répliquées*, des *données codées par effacement (EC)* ou les deux.

Vous pouvez également surveiller l'état des tâches de restauration de volume en cours et afficher un historique des tâches de restauration terminées danslink:../maintain/restoring-volume.html["Gestionnaire de grille"] .

[role="tabbed-block"]
====
.Données répliquées
--
* Pour obtenir une estimation du pourcentage d'achèvement de la réparation répliquée, ajoutez le `show-replicated-repair-status` option à la commande repair-data.
+
`repair-data show-replicated-repair-status`

* Pour déterminer si les réparations sont terminées :
+
.. Sélectionnez *NODES* > *_Nœud de stockage en cours de réparation_* > *ILM*.
.. Passez en revue les attributs dans la section Évaluation.  Lorsque les réparations sont terminées, l'attribut *En attente - Tout* indique 0 objet.


* Pour suivre la réparation plus en détail :
+
.. Sélectionnez *SUPPORT* > *Outils* > *Topologie de grille*.
.. Sélectionnez *_grid_* > *_Nœud de stockage en cours de réparation_* > *LDR* > *Data Store*.
.. Utilisez une combinaison des attributs suivants pour déterminer, aussi bien que possible, si les réparations répliquées sont complètes.
+

NOTE: Des incohérences de Cassandra peuvent être présentes et les réparations ayant échoué ne sont pas suivies.

+
*** *Réparations tentées (XRPA)* : utilisez cet attribut pour suivre la progression des réparations répliquées.  Cet attribut augmente chaque fois qu'un nœud de stockage tente de réparer un objet à haut risque.  Lorsque cet attribut n'augmente pas pendant une période supérieure à la période d'analyse actuelle (fournie par l'attribut *Période d'analyse -- Estimée*), cela signifie que l'analyse ILM n'a trouvé aucun objet à haut risque devant être réparé sur aucun nœud.
+

NOTE: Les objets à haut risque sont des objets qui risquent d’être complètement perdus.  Cela n'inclut pas les objets qui ne satisfont pas à leur configuration ILM.

*** *Période d'analyse – Estimée (XSCM)* : utilisez cet attribut pour estimer quand un changement de politique sera appliqué aux objets précédemment ingérés.  Si l'attribut *Réparations tentées* n'augmente pas pendant une période supérieure à la période d'analyse actuelle, il est probable que des réparations répliquées sont effectuées.  Notez que la période d'analyse peut changer.  L'attribut *Période d'analyse -- Estimée (XSCM)* s'applique à l'ensemble de la grille et correspond au maximum de toutes les périodes d'analyse des nœuds.  Vous pouvez interroger l'historique de l'attribut *Période d'analyse -- Estimée* pour la grille afin de déterminer une période appropriée.






--
.Données codées par effacement (EC)
--
Pour surveiller la réparation des données codées par effacement et réessayer toutes les demandes qui auraient échoué :

. Déterminer l’état des réparations des données codées par effacement :
+
** Sélectionnez *SUPPORT* > *Outils* > *Métriques* pour afficher le temps estimé jusqu'à l'achèvement et le pourcentage d'achèvement de la tâche en cours. Ensuite, sélectionnez *EC Overview* dans la section Grafana. Consultez les tableaux de bord *Temps estimé d'achèvement du travail EC de la grille* et *Pourcentage d'achèvement du travail EC de la grille*.
** Utilisez cette commande pour voir l'état d'un élément spécifique `repair-data` opération:
+
`repair-data show-ec-repair-status --repair-id repair ID`

** Utilisez cette commande pour lister toutes les réparations :
+
`repair-data show-ec-repair-status`

+
La sortie répertorie les informations, y compris `repair ID` , pour toutes les réparations effectuées et en cours.



. Si la sortie indique que l'opération de réparation a échoué, utilisez le `--repair-id` possibilité de réessayer la réparation.
+
Cette commande réessaie une réparation de nœud ayant échoué, en utilisant l'ID de réparation 6949309319275667690 :

+
`repair-data start-ec-node-repair --repair-id 6949309319275667690`

+
Cette commande réessaie une réparation de volume ayant échoué, en utilisant l'ID de réparation 6949309319275667690 :

+
`repair-data start-ec-volume-repair --repair-id 6949309319275667690`



--
====