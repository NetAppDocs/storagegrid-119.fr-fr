---
permalink: ilm/example-4-ilm-rules-and-policy-for-s3-versioned-objects.html 
sidebar: sidebar 
keywords: object versions, example ILM rule, information lifecycle rule examples 
summary: 'Si vous disposez d"un compartiment S3 avec le contrôle de version activé, vous pouvez gérer les versions d"objet non actuelles en incluant des règles dans votre stratégie ILM qui utilisent l"heure non actuelle comme heure de référence.' 
---
= Exemple 4 : Règles et politique ILM pour les objets versionnés S3
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Si vous disposez d'un compartiment S3 avec le contrôle de version activé, vous pouvez gérer les versions d'objet non actuelles en incluant des règles dans votre stratégie ILM qui utilisent « Heure non actuelle » comme heure de référence.


CAUTION: Si vous spécifiez une durée de conservation limitée pour les objets, ces objets seront supprimés définitivement une fois la période atteinte.  Assurez-vous de bien comprendre combien de temps les objets seront conservés.

Comme le montre cet exemple, vous pouvez contrôler la quantité de stockage utilisée par les objets versionnés en utilisant différentes instructions de placement pour les versions d'objet non actuelles.


CAUTION: Les règles et politiques ILM suivantes ne sont que des exemples.  Il existe de nombreuses façons de configurer les règles ILM.  Avant d’activer une nouvelle politique, simulez-la pour confirmer qu’elle fonctionnera comme prévu pour protéger le contenu contre la perte.


NOTE: Pour effectuer une simulation de stratégie ILM sur une version non actuelle d'un objet, vous devez connaître l'UUID ou le CBID de la version de l'objet.  Pour trouver l'UUID et le CBID, utilisezlink:verifying-ilm-policy-with-object-metadata-lookup.html["recherche de métadonnées d'objet"] tant que l'objet est toujours d'actualité.

.Informations connexes
link:how-objects-are-deleted.html["Comment les objets sont supprimés"]



== Règle ILM 1 par exemple 4 : Conservez trois copies pendant 10 ans

Cet exemple de règle ILM stocke une copie de chaque objet sur trois sites pendant 10 ans.

Cette règle s'applique à tous les objets, qu'ils soient versionnés ou non.

[cols="1a,2a"]
|===
| Définition de la règle | Exemple de valeur 


 a| 
Piscines de stockage
 a| 
Trois pools de stockage, chacun composé de centres de données différents, nommés Site 1, Site 2 et Site 3.



 a| 
Nom de la règle
 a| 
Trois exemplaires dix ans



 a| 
Heure de référence
 a| 
Temps d'ingestion



 a| 
Placements
 a| 
Le jour 0, conservez trois copies répliquées pendant 10 ans (3 652 jours), une sur le site 1, une sur le site 2 et une sur le site 3.  Au bout de 10 ans, supprimez toutes les copies de l'objet.

|===


== Règle ILM 2 pour l'exemple 4 : Conservez deux copies des versions non actuelles pendant 2 ans

Cet exemple de règle ILM stocke deux copies des versions non actuelles d'un objet versionné S3 pendant 2 ans.

Étant donné que la règle ILM 1 s’applique à toutes les versions de l’objet, vous devez créer une autre règle pour filtrer toutes les versions non actuelles.

Pour créer une règle qui utilise « Heure non actuelle » comme heure de référence, sélectionnez *Oui* pour la question « Appliquer cette règle uniquement aux anciennes versions d'objet (dans les compartiments S3 avec le contrôle de version activé) ? » à l'étape 1 (Saisir les détails) de l'assistant Créer une règle ILM.  Lorsque vous sélectionnez *Oui*, _Heure non actuelle_ est automatiquement sélectionné comme heure de référence et vous ne pouvez pas sélectionner une heure de référence différente.

image::../media/ilm-rule-apply-only-to-older-object-verions.png[Appliquer la règle ILM uniquement aux anciennes versions d'objet (heure non actuelle)]

Dans cet exemple, seules deux copies des versions non actuelles sont stockées, et ces copies seront stockées pendant deux ans.

[cols="1a,2a"]
|===
| Définition de la règle | Exemple de valeur 


 a| 
Piscines de stockage
 a| 
Deux pools de stockage, chacun dans des centres de données différents, Site 1 et Site 2.



 a| 
Nom de la règle
 a| 
Versions non actuelles : deux exemplaires, deux ans



 a| 
Heure de référence
 a| 
Temps non actuel

Sélectionné automatiquement lorsque vous sélectionnez *Oui* pour la question « Appliquer cette règle uniquement aux anciennes versions d'objet (dans les compartiments S3 avec le contrôle de version activé) ? » dans l'assistant Créer une règle ILM.



 a| 
Placements
 a| 
Le jour 0 par rapport à la période non courante (c'est-à-dire à partir du jour où la version de l'objet devient la version non courante), conservez deux copies répliquées des versions de l'objet non courantes pendant 2 ans (730 jours), une sur le site 1 et une sur le site 2.  Au bout de 2 ans, supprimez les versions non actuelles.

|===


== Politique ILM pour l'exemple 4 : objets versionnés S3

Si vous souhaitez gérer les anciennes versions d'un objet différemment de la version actuelle, les règles qui utilisent « Heure non actuelle » comme heure de référence doivent apparaître dans la stratégie ILM avant les règles qui s'appliquent à la version actuelle de l'objet.

Une politique ILM pour les objets versionnés S3 peut inclure des règles ILM telles que les suivantes :

* Conservez toutes les versions plus anciennes (non actuelles) de chaque objet pendant 2 ans, à compter du jour où la version est devenue non actuelle.
+

NOTE: Les règles « Heure non actuelle » doivent apparaître dans la politique avant les règles qui s'appliquent à la version actuelle de l'objet.  Dans le cas contraire, les versions d'objet non actuelles ne seront jamais mises en correspondance avec la règle « Heure non actuelle ».

* Lors de l’ingestion, créez trois copies répliquées et stockez une copie sur chacun des trois sites.  Conservez des copies de la version actuelle de l'objet pendant 10 ans.


Lorsque vous simulez l’exemple de politique, vous vous attendez à ce que les objets de test soient évalués comme suit :

* Toutes les versions d’objet non actuelles seront mises en correspondance avec la première règle.  Si une version d'objet non actuelle a plus de 2 ans, elle est définitivement supprimée par ILM (toutes les copies de la version non actuelle sont supprimées de la grille).
* La version actuelle de l'objet correspondrait à la deuxième règle.  Lorsque la version actuelle de l'objet a été stockée pendant 10 ans, le processus ILM ajoute un marqueur de suppression comme version actuelle de l'objet et rend la version précédente de l'objet « non actuelle ».  Lors de la prochaine évaluation ILM, cette version non actuelle correspond à la première règle.  En conséquence, la copie du site 3 est purgée et les deux copies des sites 1 et 2 sont stockées pendant 2 ans supplémentaires.

